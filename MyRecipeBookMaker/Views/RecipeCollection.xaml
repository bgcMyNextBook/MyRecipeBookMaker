<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="MyRecipeBookMaker.Views.RecipeCollection"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:buttons="clr-namespace:Syncfusion.Maui.Toolkit.Buttons;assembly=Syncfusion.Maui.Toolkit"
    xmlns:common="clr-namespace:MyRecipeBookMaker.Common"
    xmlns:dx="clr-namespace:DevExpress.Maui.Core;assembly=DevExpress.Maui.Core"
    xmlns:listView="clr-namespace:Syncfusion.Maui.ListView;assembly=Syncfusion.Maui.ListView"
    xmlns:local="clr-namespace:MyRecipeBookMaker"
    xmlns:models="clr-namespace:MyRecipeBookMaker.Models"
    xmlns:radialMenu="clr-namespace:Syncfusion.Maui.RadialMenu;assembly=Syncfusion.Maui.RadialMenu"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    Title="Recipe Collection">

    <ContentPage.BindingContext>
        <local:RecipeCollectionViewModel />
    </ContentPage.BindingContext>
    <ContentPage.Resources>
        <ResourceDictionary>
            <toolkit:IsStringNullOrWhiteSpaceConverter x:Key="IsStringNullOrWhiteSpaceConverter" />

            <x:String x:Key="failedStatus">failed</x:String>
            <toolkit:CompareConverter
                x:Key="CompareConverter"
                ComparingValue="{StaticResource failedStatus}"
                ComparisonOperator="Equal"
                FalseObject="{dx:ThemeColor OnSurface}"
                TrueObject="{dx:ThemeColor Error}" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ContentPage.Content>
        <Grid SizeChanged="Grid_SizeChanged">

            <radialMenu:SfRadialMenu
                x:Name="addMenu"
                CenterButtonRadius="25"
                CenterButtonText="Add"
                Closing="addMenu_Closing"
                IsOpen="{Binding ShowAddMenu}"
                IsVisible="True"
                Opening="addMenu_Opening"
                Point="{Binding AddMenuPoint}"
                RimRadius="180"
                ZIndex="20">

                <radialMenu:SfRadialMenu.Items>
                    <radialMenu:SfRadialMenuItem
                        Command="{Binding AddRecipeoByPdfCommand}"
                        FontSize="10"
                        Text="PDF" />
                    <radialMenu:SfRadialMenuItem
                        Command="{Binding AddRecipeByCameraCommand}"
                        FontSize="10"
                        Text="Camera" />
                    <radialMenu:SfRadialMenuItem
                        Command="{Binding AddRecipeByPhotoByAlbumCommand}"
                        FontSize="10"
                        Text="Album" />
                </radialMenu:SfRadialMenu.Items>
            </radialMenu:SfRadialMenu>
            <ScrollView Margin="0,40">
                <FlexLayout
                    Padding="8"
                    AlignContent="Start"
                    AlignItems="Start"
                    BindableLayout.ItemsSource="{Binding ListOfRecipes}"
                    Direction="Row"
                    JustifyContent="Start"
                    Wrap="Wrap">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate>
                            <Border
                                HeightRequest="120"
                                MaximumWidthRequest="600"
                                Stroke="Transparent"
                                StrokeShape="RoundRectangle 4,4,4,4"
                                StrokeThickness="0"
                                WidthRequest="400">
                                <!--  View of each card item  -->
                                <Border
                                    Margin="10"
                                    Padding="0"
                                    BackgroundColor="{AppThemeBinding Light={DynamicResource BackgroundColorLight},
                                                                      Dark={DynamicResource BackgroundColorDark}}"
                                    HorizontalOptions="Fill"
                                    Stroke="{AppThemeBinding Light={DynamicResource BackgroundColorLight},
                                                             Dark={DynamicResource BackgroundColorDark}}"
                                    StrokeShape="RoundRectangle 10"
                                    StrokeThickness="1"
                                    VerticalOptions="Fill">

                                    <Grid
                                        ColumnDefinitions="120, *"
                                        ColumnSpacing="0"
                                        RowDefinitions="*,*"
                                        MaximumHeightRequest="120"
                                        RowSpacing="0">

                                        <!--  Image to display the Item  -->
                                        <Image
                                            Aspect="AspectFill"
                                            Grid.RowSpan="2"
                                            Grid.Row="0"
                                            Grid.Column="0"
                                            BackgroundColor="{DynamicResource Gray-200}"
                                            HeightRequest="120"
                                            Source="{Binding ImageData}"
                                            WidthRequest="120" />
                                        <StackLayout
                                            Grid.Column="1"
                                            Margin="4"
                                            HorizontalOptions="Fill"
                                            Spacing="0"
                                            VerticalOptions="Start">

                                            <!--  Name of the item  -->
                                            <Label
                                                Grid.Row="0"
                                                FontFamily="Roboto-Medium"
                                                HorizontalOptions="Start"
                                                HorizontalTextAlignment="Start"
                                                Text="{Binding Name}"
                                                TextColor="{AppThemeBinding Light={DynamicResource PrimaryTextColorLight},
                                                                            Dark={DynamicResource PrimaryTextColorDark}}"
                                                VerticalOptions="Start" />
                                            <Label
                                                Grid.Row="1"
                                                ZIndex="2"
                                                FontFamily="Roboto-Regular"
                                                FontSize="12"
                                                HorizontalOptions="Start"
                                                HorizontalTextAlignment="Start"
                                                IsEnabled="False"
                                                IsVisible="{Binding Status}"
                                                MaxLines="5"
                                                Text="{Binding ProcessingMessage}"
                                                TextColor="{dx:ThemeColor Error}" />
                                            <!--  Description about the item  -->
                                            <Label
                                                Margin="0,2,10,8"
                                                FontFamily="Roboto-Regular"
                                                FontSize="12"
                                                HorizontalOptions="Start"
                                                HorizontalTextAlignment="Start"
                                                LineBreakMode="TailTruncation"
                                                LineHeight="{OnPlatform Android=1.25,
                                                                        Default=-1}"
                                                MaxLines="5"
                                                Text="{Binding Description}"
                                                TextColor="{AppThemeBinding Light={DynamicResource SecondaryTextColorLight},
                                                                            Dark={DynamicResource SecondaryTextColorDark}}" />

                                            <!--  Average rating from the overall rating  -->

                                        </StackLayout>
                                    </Grid>
                                </Border>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type local:RecipeCollectionViewModel}}, Path=ItemTappedCommand}" CommandParameter="{Binding .}" />
                                </Border.GestureRecognizers>
                            </Border>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </FlexLayout>
            </ScrollView>
        </Grid>
    </ContentPage.Content>
</ContentPage>